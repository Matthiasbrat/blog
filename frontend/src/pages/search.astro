---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Search">
  <h1>Search</h1>
  <div class="search-box">
    <input type="search" id="search-input" placeholder="Search..." autofocus />
  </div>
  <div id="search-results"></div>
</BaseLayout>

<style>
  h1 {
    margin-bottom: var(--space-lg);
  }
  
  .search-box {
    margin-bottom: var(--space-xl);
  }
  
  #search-input {
    width: 100%;
    padding: var(--space-sm);
    font-family: var(--font-body);
    font-size: 1rem;
    border: 1px solid var(--color-border);
    background: var(--color-bg);
  }
  
  #search-input:focus {
    outline: none;
    border-color: var(--color-text);
  }
  
  #search-results :global(.result) {
    margin-bottom: var(--space-md);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--color-border);
  }
  
  #search-results :global(.result:last-child) {
    border-bottom: none;
  }
  
  #search-results :global(.result a) {
    font-weight: normal;
  }
  
  #search-results :global(.excerpt) {
    font-size: 0.9375rem;
    color: var(--color-text-muted);
    margin-top: var(--space-xs);
  }
  
  #search-results :global(mark) {
    background: #ff0;
    color: inherit;
  }
</style>

<script>
  const searchInput = document.getElementById('search-input') as HTMLInputElement;
  const resultsContainer = document.getElementById('search-results');
  
  const searchData = [
    { title: 'Mastering Async/Await', url: '/blog/javascript/async-await', excerpt: 'A comprehensive guide to writing cleaner asynchronous code' },
    { title: 'Understanding Closures', url: '/blog/javascript/closures', excerpt: 'A practical guide to closures and their everyday use cases' },
    { title: 'ES6 Modules Explained', url: '/blog/javascript/es6-modules', excerpt: 'Understanding import and export in modern JavaScript' },
    { title: 'Promises: A Deep Dive', url: '/blog/javascript/promises-deep-dive', excerpt: 'Everything you need to know about JavaScript Promises' },
    { title: 'Understanding Ownership', url: '/blog/rust/ownership', excerpt: 'Deep dive into Rust ownership system' },
    { title: 'Demystifying Lifetimes', url: '/blog/rust/lifetimes', excerpt: 'A clear explanation of Rust lifetime system' },
    { title: 'Error Handling in Rust', url: '/blog/rust/error-handling', excerpt: 'Mastering Result, Option, and the ? operator' },
    { title: 'Advanced Generics', url: '/blog/typescript/generics', excerpt: 'Master TypeScript powerful generic type system' },
    { title: 'Utility Types', url: '/blog/typescript/utility-types', excerpt: 'Quick reference for TypeScript built-in utility types' },
    { title: 'Installation Guide', url: '/docs/getting-started/installation', excerpt: 'Step-by-step instructions to install and set up' },
    { title: 'Quick Start', url: '/docs/getting-started/quick-start', excerpt: 'Build your first project in under 5 minutes' },
  ];
  
  let timer: number;
  
  searchInput?.addEventListener('input', (e) => {
    clearTimeout(timer);
    timer = window.setTimeout(() => {
      const q = (e.target as HTMLInputElement).value.toLowerCase().trim();
      
      if (!q) {
        resultsContainer!.innerHTML = '';
        return;
      }
      
      const results = searchData.filter(item => 
        item.title.toLowerCase().includes(q) || item.excerpt.toLowerCase().includes(q)
      );
      
      if (results.length === 0) {
        resultsContainer!.innerHTML = '<p>No results found.</p>';
        return;
      }
      
      resultsContainer!.innerHTML = results.map(r => `
        <div class="result">
          <a href="${r.url}">${highlight(r.title, q)}</a>
          <p class="excerpt">${highlight(r.excerpt, q)}</p>
        </div>
      `).join('');
    }, 150);
  });
  
  function highlight(text: string, query: string): string {
    return text.replace(new RegExp(`(${query})`, 'gi'), '<mark>$1</mark>');
  }
</script>
