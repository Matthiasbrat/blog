---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout 
  title="Search" 
  description="Search through all content on this site"
>
  <div class="container-narrow">
    <div class="search-header">
      <h1>Search</h1>
      <p class="search-description">
        Find articles, documentation, and more across the entire site
      </p>
    </div>
    
    <div id="search"></div>
  </div>
</BaseLayout>

<script>
  // For development mode, show a message that Pagefind requires a production build
  if (import.meta.env.DEV) {
    const searchDiv = document.getElementById('search');
    if (searchDiv) {
      searchDiv.innerHTML = `
        <div style="padding: 2rem; text-align: center; background: var(--pastel-green); border-radius: var(--radius-lg); margin-top: 2rem;">
          <p style="font-size: 1.125rem; color: var(--text); margin: 0;">
            üîç <strong>Search is available in production mode</strong>
          </p>
          <p style="color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9375rem;">
            Run <code style="background: white; padding: 0.2em 0.6em; border-radius: 4px;">yarn build</code> to generate the search index
          </p>
        </div>
      `;
    }
  } else {
    // In production, load Pagefind UI
    const script = document.createElement('link');
    script.rel = 'stylesheet';
    script.href = '/pagefind/pagefind-ui.css';
    document.head.appendChild(script);

    const js = document.createElement('script');
    js.src = '/pagefind/pagefind-ui.js';
    js.onload = () => {
      // @ts-ignore
      new PagefindUI({
        element: '#search',
        showSubResults: true,
        showImages: false,
        excerptLength: 20,
        resetStyles: false
      });
    };
    document.body.appendChild(js);
  }
</script>

<style>
  .search-header {
    margin-bottom: var(--space-2xl);
    text-align: center;
  }
  
  .search-description {
    color: var(--text-secondary);
    font-size: 1.125rem;
    margin-top: var(--space-md);
  }
  
  #search {
    margin-top: var(--space-xl);
  }
  
  /* Custom styling for Pagefind UI */
  :global(.pagefind-ui) {
    --pagefind-ui-scale: 1;
    --pagefind-ui-primary: var(--accent);
    --pagefind-ui-text: var(--text);
    --pagefind-ui-background: var(--bg);
    --pagefind-ui-border: var(--border);
    --pagefind-ui-tag: var(--pastel-green);
    --pagefind-ui-border-width: 1px;
    --pagefind-ui-border-radius: var(--radius-md);
    --pagefind-ui-font: var(--font-body);
  }
  
  :global(.pagefind-ui__search-input) {
    height: 3.5rem;
    font-size: 1.125rem;
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 0 var(--space-lg);
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }
  
  :global(.pagefind-ui__search-input:focus) {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--pastel-green);
  }
  
  :global(.pagefind-ui__result) {
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: var(--space-lg);
    margin-bottom: var(--space-md);
    background: var(--bg-card);
    transition: box-shadow 0.2s ease, border-color 0.2s ease;
  }
  
  :global(.pagefind-ui__result:hover) {
    border-color: var(--accent-light);
    box-shadow: var(--shadow-md);
  }
  
  :global(.pagefind-ui__result-title) {
    font-family: var(--font-heading);
    font-size: 1.25rem;
    color: var(--text);
    margin-bottom: var(--space-sm);
  }
  
  :global(.pagefind-ui__result-link) {
    text-decoration: none;
    color: var(--text);
  }
  
  :global(.pagefind-ui__result-link:hover) {
    color: var(--accent);
  }
  
  :global(.pagefind-ui__result-excerpt) {
    color: var(--text-secondary);
    line-height: 1.6;
  }
  
  :global(.pagefind-ui__message) {
    text-align: center;
    padding: var(--space-2xl);
    color: var(--text-secondary);
  }
  
  :global(mark) {
    background: var(--pastel-green-dark);
    color: var(--text);
    padding: 0.1em 0.3em;
    border-radius: var(--radius-sm);
  }
</style>
