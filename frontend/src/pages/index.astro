---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getSiteConfig } from '../lib/sections';
import { getTopicsForSection, getContentForTopic } from '../lib/content';
import PostItem from '../components/PostItem.astro';

const siteConfig = getSiteConfig();

// Get recent blog posts
const blogTopics = getTopicsForSection('blog');
let recentPosts: any[] = [];
for (const topic of blogTopics) {
  const posts = getContentForTopic('blog', topic.slug);
  recentPosts = [...recentPosts, ...posts.map(p => ({ ...p, topic: topic.slug }))];
}
recentPosts = recentPosts
  .sort((a, b) => (b.date?.getTime() || 0) - (a.date?.getTime() || 0))
  .slice(0, 10);
---

<BaseLayout>
  <section class="intro">
    <h1>{siteConfig.site.title}</h1>
    <p>
      Welcome. I write about programming, share documentation, and connect with great people.
      Browse the <a href="/blog">blog</a>, read the <a href="/docs">docs</a>, 
      or see <a href="/referrals">people I recommend</a>.
    </p>
  </section>
  
  <section class="recent">
    <h2>Recent Writing</h2>
    <ul class="post-list">
      {recentPosts.map(post => (
        <PostItem 
          title={post.title} 
          href={`/blog/${post.topic}/${post.slug}`}
          date={post.date}
        />
      ))}
    </ul>
    <p><a href="/blog">All posts â†’</a></p>
  </section>
</BaseLayout>

<style>
  .intro {
    margin-bottom: var(--space-xl);
  }
  
  .intro h1 {
    margin-bottom: var(--space-md);
  }
  
  .intro p {
    font-size: 1.125rem;
  }
  
  .recent h2 {
    border-bottom: 1px solid var(--color-border);
    padding-bottom: var(--space-xs);
    margin-bottom: var(--space-lg);
  }
  
  .post-list {
    margin-bottom: var(--space-lg);
  }
</style>
