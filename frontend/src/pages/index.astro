---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getSiteConfig } from '../lib/sections';
import { getTopicsForSection, getContentForTopic } from '../lib/content';
import PostItem from '../components/PostItem.astro';

const siteConfig = getSiteConfig();

// Get recent blog posts
const blogTopics = getTopicsForSection('blog');
let recentPosts: any[] = [];
for (const topic of blogTopics) {
  const posts = getContentForTopic('blog', topic.slug);
  recentPosts = [...recentPosts, ...posts.map(p => ({ ...p, topic: topic.slug }))];
}
recentPosts = recentPosts
  .sort((a, b) => (b.date?.getTime() || 0) - (a.date?.getTime() || 0))
  .slice(0, 8);
---

<BaseLayout>
  <header class="intro">
    <h1>Welcome</h1>
    <p>
      I'm {siteConfig.site.author}. I write about programming, share documentation, 
      and connect with great people. Browse around.
    </p>
  </header>
  
  <section>
    <h2>Recent Writing</h2>
    <ul class="post-list">
      {recentPosts.map(post => (
        <PostItem 
          title={post.title} 
          href={`/blog/${post.topic}/${post.slug}`}
          date={post.date}
        />
      ))}
    </ul>
    <p class="view-all"><a href="/blog">View all posts â†’</a></p>
  </section>
</BaseLayout>

<style>
  .intro {
    margin-bottom: var(--space-2xl);
  }
  
  .intro p {
    font-size: 1.25rem;
    color: var(--color-text-light);
    max-width: 55ch;
  }
  
  section h2 {
    margin-top: 0;
  }
  
  .view-all {
    margin-top: var(--space-lg);
    font-family: var(--font-sans);
    font-size: 0.9375rem;
  }
</style>
